---
layout: post
title:  "DoubleBuffering"
date:   2024-10-23 00:00:00 +0000
categories: Qt
excerpt_image: /assets/images/DoubleBuffering/ä¼ä¸šå¾®ä¿¡æˆªå›¾_17296740734787.png
tags: [Qt]
---

åœ¨å¼€å‘Qtæ¡Œé¢å®¢æˆ·ç«¯è¿‡ç¨‹ä¸­ä¼šé‡åˆ°ç•Œé¢å…ƒç´ é—ªçƒçš„é—®é¢˜ã€‚æ¯”å¦‚listviewæ›´æ–°modelæ•°æ®.å¯ä»¥ä½¿ç”¨åŒç¼“å†²çš„æŠ€æœ¯è§£å†³.

## åŒç¼“å†²(Double Buffer)
èŠåˆ°åŒç¼“å†²å‰å…ˆè¯´è¯´å•ç¼“å†²è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆå•ç¼“å†²ä¸‹ç•Œé¢ä¼šå¡é¡¿.ç½‘ä¸Šå…³äºåŒç¼“å†²çš„æ–‡ç« æªè¾å¤ªè¿‡å­¦æœ¯ç†è§£èµ·æ¥ä¸å¤ªç›´è§‚.ç¬”è€…è¿™é‡Œä½¿ç”¨ä¸€äº›"äººè¯"å¸Œæœ›å¯ä»¥è¡¨è¾¾æ¸…æ¥š.

- å•ç¼“å†²: å›¾åƒæ•°æ®æ—¢è§†å›¾æ•°æ®, ä¿®æ”¹å›¾åƒæ•°æ®çš„åŒæ—¶ç•Œé¢ä¹Ÿåœ¨åˆ·æ–°, ä¿®æ”¹å›¾åƒæ•°æ®æ˜¯ä¸€ä¸ªåŒæ­¥æ“ä½œ, ç”Ÿæˆçš„å›¾åƒä¸æ˜¯ä¸€ä¸‹å­è¢«ç»˜åˆ¶å‡ºæ¥çš„ï¼Œè€Œæ˜¯æŒ‰ç…§ä»å·¦åˆ°å³ï¼Œç”±ä¸Šè€Œä¸‹é€åƒç´ åœ°ç»˜åˆ¶è€Œæˆçš„, å›¾åƒä¸æ˜¯åœ¨ç¬é—´æ˜¾ç¤ºç»™ç”¨æˆ·, è¶Šæ˜¯å¤æ‚çš„å›¾åƒæ•°æ®é—ªå±å¡é¡¿çš„ç°è±¡è¶Šæ˜¯æ˜æ˜¾.

- åŒç¼“å­˜: å‰ç¼“å†²ä¿å­˜å›¾åƒæ•°æ®, åç¼“å†²ä¿å­˜è§†å›¾æ•°æ®, ç®€å•ç†è§£å°±æ˜¯ä¸¤å—å†…å­˜æ˜¾ç¤ºçš„éƒ½æ˜¯ç¬¬äºŒå—çš„å†…å®¹, ç¬¬ä¸€å—çš„å†…å®¹å¤„ç†å®Œæ¯•å¯ä»¥ä½¿ç”¨æ—¶, swapç¬¬äºŒå—å†…å­˜. swapæ“ä½œç›¸å¯¹ç”Ÿæˆå›¾åƒè¦å¿«çš„å¤šæ‰€ä»¥ä¸ä¼šå‡ºç°é—ªå±å¡é¡¿é—®é¢˜.

## Qtä¸­çš„åŒç¼“å†²
QWidget
```c++
void MyWidget::paintEvent(QPaintEvent *event) {
    QPainter painter(&QPixmap());
    // åœ¨ pixmap ä¸Šç»˜åˆ¶å†…å®¹
    painter.fillRect(pixmap.rect(), Qt::blue)
}
```

paintEventäº‹ä»¶ä¸­çš„ç»˜åˆ¶å°±æ˜¯å¡«å……å‰ç¼“å†², updateæ“ä½œå°±æ˜¯swapæ“ä½œæŠŠæ•°æ®æ¸²æŸ“åˆ°è§†å›¾.

QML
```qml
ApplicationWindow {
    visible: true
    width: 640
    height: 480

    Canvas {
        id: myCanvas
        width: parent.width
        height: parent.height

        onPaint: {
            var ctx = myCanvas.getContext("2d");
            ctx.fillStyle = "blue";
            ctx.fillRect(0, 0, myCanvas.width, myCanvas.height);
        }

        Component.onCompleted: {
            myCanvas.requestPaint(); // è§¦å‘ç»˜åˆ¶
        }
    }
}
```

onPaintäº‹ä»¶ä¸­çš„ç»˜åˆ¶å°±æ˜¯å¡«å……å‰ç¼“å†², requestPaintæ“ä½œå°±æ˜¯swapæ“ä½œæŠŠæ•°æ®æ¸²æŸ“åˆ°è§†å›¾.

## ä»åŒç¼“å†²ç†è§£ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½

å‚è€ƒä¸‹å›¾:
![alt text](/assets/images/DoubleBuffering/ä¼ä¸šå¾®ä¿¡æˆªå›¾_17296740734787.png)

å¯ä»¥æŠ½è±¡å‡ºæ¥ä¸€ä¸ªé«˜æ¸²æŸ“æ€§èƒ½çš„æ€ç»´æ¨¡æ¿:

ğŸ’ `å·¥ä½œçº¿ç¨‹å¤„ç†æ‰§è¡Œ æ„å»ºå¤æ‚å›¾åƒå…ƒç´ çš„è€—æ—¶æ“ä½œ, Guiçº¿ç¨‹åªè´Ÿè´£swapå’Œrenderingæ“ä½œ.`

æ¯”å¦‚:

listviewç”Ÿæˆmodelçš„æ“ä½œåœ¨å·¥ä½œçº¿ç¨‹æ‰§è¡Œ, emitæ›´æ–°æ•°æ®çš„æ“ä½œåœ¨ä¸»çº¿ç¨‹.

åœ¨[qtçš„æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£](https://doc.qt.io/qt-6/qtquick-performance.html)å…¶å®æœ‰ç±»ä¼¼çš„è¯´æ˜,åº•å±‚é€»è¾‘å’ŒåŒç¼“å†²ä¸€è‡´

![alt text](/assets/images/DoubleBuffering/image.png)

